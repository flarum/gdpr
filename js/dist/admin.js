(()=>{var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var a in r)e.o(r,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{"use strict";e.r(t),e.d(t,{extend:()=>W});const r=flarum.reg.get("core","admin/app");var a=e.n(r);const n=flarum.reg.get("core","common/extend"),s=flarum.reg.get("core","admin/components/UserListPage");var o=e.n(s);const i=flarum.reg.get("core","common/components/Button");var l=e.n(i);const d=flarum.reg.get("core","common/helpers/username");var p=e.n(d);function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function c(e,t,r){return(t=function(e){var t=function(e){if("object"!=u(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==u(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const g=flarum.reg.get("core","common/components/Form");var f=e.n(g);const h=flarum.reg.get("core","common/app");var y=e.n(h);const _=flarum.reg.get("core","common/components/Modal");var b=e.n(_);const x=flarum.reg.get("core","common/components/Avatar");var v=e.n(x);class N extends(b()){constructor(){super(...arguments),c(this,"user",void 0)}oninit(e){super.oninit(e),this.user=this.attrs.user}className(){return"RequestDataModal Modal--small"}title(){return y().translator.trans("flarum-gdpr.lib.request_data.title",{username:p()(this.user)})}content(){return m("div",{className:"Modal-body"},m(f(),{className:"Form--centered"},m("div",{className:"User"},m(v(),{user:this.user})),m("p",{className:"helpText"},y().translator.trans("flarum-gdpr.lib.request_data.text")),m("div",{className:"Form-group"},m(l(),{className:"Button Button--primary Button--block",onclick:()=>this.requestExport(),loading:this.loading,disabled:this.loading},y().translator.trans("flarum-gdpr.lib.request_data.request_button")))))}requestExport(){this.loading=!0,y().request({method:"POST",url:y().forum.attribute("apiUrl")+"/gdpr-exports",body:{data:{attributes:{userId:this.user.id()}}}}).then(this.hide.bind(this),this.loaded.bind(this))}}flarum.reg.add("flarum-gdpr","common/components/RequestDataExportModal",N);const D=flarum.reg.get("core","admin/components/AdminNav");var G=e.n(D);const w=flarum.reg.get("core","common/components/LinkButton");var T=e.n(w);const A=flarum.reg.get("core","common/extenders");var S=e.n(A);const M=flarum.reg.get("core","common/models/User");var z=e.n(M);const E=flarum.reg.get("core","common/Model");var P=e.n(E);class q extends(P()){status(){return P().attribute("status").call(this)}reason(){return P().attribute("reason").call(this)}createdAt(){return P().attribute("createdAt",P().transformDate).call(this)}userConfirmedAt(){return P().attribute("userConfirmedAt",P().transformDate).call(this)}processedAt(){return P().attribute("processedAt",P().transformDate).call(this)}processorComment(){return P().attribute("processorComment").call(this)}processedMode(){return P().attribute("processedMode").call(this)}user(){return P().hasOne("user").call(this)}processedBy(){return P().hasOne("processedBy").call(this)}}flarum.reg.add("flarum-gdpr","common/models/ErasureRequest",q);class O extends(P()){file(){return P().attribute("file").call(this)}createdAt(){return P().attribute("createdAt",P().transformDate)}destroysAt(){return P().attribute("destroysAt",P().transformDate)}user(){return P().hasOne("user")}actor(){return P().hasOne("actor")}}flarum.reg.add("flarum-gdpr","common/models/Export",O);const B=[(new(S().Store)).add("user-erasure-requests",q).add("gdpr-exports",O),new(S().Model)(z()).attribute("canModerateExports").attribute("anonymized").hasOne("erasureRequest")],j=flarum.reg.get("core","admin/components/AdminPage");var I=e.n(j);const C=flarum.reg.get("core","common/components/LoadingIndicator");var U=e.n(C);const k=flarum.reg.get("core","common/components/Tooltip");var R=e.n(k);const F=flarum.reg.get("core","common/Component");var L=e.n(F);const H=flarum.reg.get("core","common/components/Icon");var J=e.n(H);class K extends(L()){view(){const{extension:e}=this.attrs;return e?m(R(),{text:e.extra["flarum-extension"].title},m(T(),{href:a().route("extension",{id:e.id})},m("span",{className:"ExtensionIcon ExtensionIcon--gdpr",style:e.icon},!!e.icon&&m(J(),{name:e.icon.name})))):null}}flarum.reg.add("flarum-gdpr","admin/components/ExtensionLink",K);class Q extends(I()){constructor(){super(...arguments),c(this,"gdprDataTypes",[])}oninit(e){super.oninit(e),this.loadGdprDataTypes()}headerInfo(){return{className:"GdprPage--header",icon:"fas fa-user-shield",title:a().translator.trans("flarum-gdpr.admin.gdpr_page.heading"),description:a().translator.trans("flarum-gdpr.admin.gdpr_page.description")}}loadGdprDataTypes(){this.loading=!0,a().store.find("gdpr-datatypes").then((e=>{this.gdprDataTypes=e,this.loading=!1,m.redraw()}))}content(){return this.loading?m(U(),null):m("div",{className:"GdprPage"},m("h3",null,a().translator.trans("flarum-gdpr.admin.gdpr_page.settings.heading")),m("p",{className:"helpText"},a().translator.trans("flarum-gdpr.admin.gdpr_page.settings.help_text")),m(T(),{className:"Button",href:a().route("extension",{id:"flarum-gdpr"})},a().translator.trans("flarum-gdpr.admin.gdpr_page.settings.extension_settings_button")),m("hr",null),m("h3",null,a().translator.trans("flarum-gdpr.admin.gdpr_page.data_types.title")),m("p",{className:"helpText"},a().translator.trans("flarum-gdpr.admin.gdpr_page.data_types.help_text")),m("div",{className:"GdprGrid"},m("div",{class:"GdprGrid-row"},m("div",{className:"GdprGrid-header"},a().translator.trans("flarum-gdpr.admin.gdpr_page.data_types.type")),m("div",{className:"GdprGrid-header"},a().translator.trans("flarum-gdpr.admin.gdpr_page.data_types.export_description")),m("div",{className:"GdprGrid-header"},a().translator.trans("flarum-gdpr.admin.gdpr_page.data_types.anonymize_description")),m("div",{className:"GdprGrid-header"},a().translator.trans("flarum-gdpr.admin.gdpr_page.data_types.delete_description")),m("div",{className:"GdprGrid-header"},a().translator.trans("flarum-gdpr.admin.gdpr_page.data_types.extension"))),this.gdprDataTypes.map((e=>m("[",null,m("div",{class:"GdprGrid-row"},m("div",null,m(R(),{text:e.id()},m("span",{className:"helpText"},e.type()))),m("div",{className:"helpText"},e.exportDescription()),m("div",{className:"helpText"},e.anonymizeDescription()),m("div",{className:"helpText"},e.deleteDescription()),m("div",null,m(K,{extension:e.extension()?a().data.extensions[e.extension()]:null}))))))),m("hr",null),m("h3",null,a().translator.trans("flarum-gdpr.admin.gdpr_page.user_table_data.title")),m("p",{className:"helpText"},a().translator.trans("flarum-gdpr.admin.gdpr_page.user_table_data.help_text")),m("div",{className:"GdprUserColumnData"},"Not yet implemented"))}}flarum.reg.add("flarum-gdpr","admin/components/GdprPage",Q);class V extends(P()){type(){return P().attribute("type").call(this)}exportDescription(){return P().attribute("exportDescription").call(this)}anonymizeDescription(){return P().attribute("anonymizeDescription").call(this)}deleteDescription(){return P().attribute("deleteDescription").call(this)}extension(){return P().attribute("extension").call(this)}}flarum.reg.add("flarum-gdpr","admin/models/DataType",V);const W=[...B,(new(S().Routes)).add("gdpr","/gdpr",Q),(new(S().Store)).add("gdpr-datatypes",V),(new(S().Admin)).setting((()=>function(){return m("div",{className:"Form-group"},m("h3",null,a().translator.trans("flarum-gdpr.admin.settings.gdpr_page.title")),m("p",{className:"helpText"},a().translator.trans("flarum-gdpr.admin.settings.gdpr_page.help_text")),m(T(),{href:a().route("gdpr"),icon:"fas fa-user-shield",className:"Button"},a().translator.trans("flarum-gdpr.admin.nav.gdpr_button")))})).setting((()=>({setting:"flarum-gdpr.allow-anonymization",label:a().translator.trans("flarum-gdpr.admin.settings.allow_anonymization"),help:a().translator.trans("flarum-gdpr.admin.settings.allow_anonymization_help"),type:"boolean"}))).setting((()=>({setting:"flarum-gdpr.allow-deletion",label:a().translator.trans("flarum-gdpr.admin.settings.allow_deletion"),help:a().translator.trans("flarum-gdpr.admin.settings.allow_deletion_help"),type:"boolean"}))).setting((()=>({setting:"flarum-gdpr.default-erasure",label:a().translator.trans("flarum-gdpr.admin.settings.default_erasure"),help:a().translator.trans("flarum-gdpr.admin.settings.default_erasure_help"),type:"select",options:{anonymization:a().translator.trans("flarum-gdpr.admin.settings.default_erasure_options.anonymization"),deletion:a().translator.trans("flarum-gdpr.admin.settings.default_erasure_options.deletion")}}))).setting((()=>({setting:"flarum-gdpr.default-anonymous-username",type:"string",label:a().translator.trans("flarum-gdpr.admin.settings.default_anonymous_username"),help:a().translator.trans("flarum-gdpr.admin.settings.default_anonymous_username_help")}))).permission((()=>({icon:"fas fa-user-minus",label:a().translator.trans("flarum-gdpr.admin.permissions.process_erasure"),permission:"processErasure"})),"moderate").permission((()=>({icon:"fas fa-file-export",label:a().translator.trans("flarum-gdpr.admin.permissions.process_export_for_others"),permission:"moderateExport"})),"moderate").permission((()=>({icon:"fas fa-eye",label:a().translator.trans("flarum-gdpr.admin.permissions.see_anonymized_user_badges"),permission:"seeAnonymizedUserBadges",allowGuest:!0})),"view")];a().initializers.add("flarum-gdpr",(()=>{a().registry.for("flarum-gdpr"),(0,n.extend)(o().prototype,"userActionItems",(function(e,t){t.canModerateExports()&&e.add("export-data",m(l(),{className:"Button",icon:"fas fa-file-export",onclick:()=>a().modal.show(N,{user:t})},a().translator.trans("flarum-gdpr.admin.userlist.columns.gdpr_actions.export",{username:p()(t)})))})),(0,n.extend)(G().prototype,"items",(function(e){e.add("gdpr",m(T(),{href:a().route("gdpr"),icon:"fas fa-user-shield",title:a().translator.trans("flarum-gdpr.admin.gdpr.title")},a().translator.trans("flarum-gdpr.admin.nav.gdpr_button")),48)}))}))})(),module.exports=t})();
//# sourceMappingURL=admin.js.map