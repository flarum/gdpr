(()=>{var t={n:r=>{var e=r&&r.__esModule?()=>r.default:()=>r;return t.d(e,{a:e}),e},d:(r,e)=>{for(var a in e)t.o(e,a)&&!t.o(r,a)&&Object.defineProperty(r,a,{enumerable:!0,get:e[a]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},r={};(()=>{"use strict";t.r(r),t.d(r,{extend:()=>Q});const e=flarum.core.compat["admin/app"];var a=t.n(e);const n=flarum.core.compat["common/extend"],s=flarum.core.compat["admin/components/UserListPage"];var o=t.n(s);const i=flarum.core.compat["common/components/Button"];var l=t.n(i);const d=flarum.core.compat["common/helpers/username"];var p=t.n(d);function u(t,r){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},u(t,r)}function c(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t,u(t,r)}const f=flarum.core.compat["common/app"];var g=t.n(f);const h=flarum.core.compat["common/components/Modal"];var y=t.n(h);const _=flarum.core.compat["common/helpers/avatar"];var v=t.n(_),b=function(t){function r(){for(var r,e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];return(r=t.call.apply(t,[this].concat(a))||this).user=void 0,r}c(r,t);var e=r.prototype;return e.oninit=function(r){t.prototype.oninit.call(this,r),this.user=this.attrs.user},e.className=function(){return"RequestDataModal Modal--small"},e.title=function(){return g().translator.trans("flarum-gdpr.lib.request_data.title",{username:p()(this.user)})},e.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"Form Form--centered"},m("div",{className:"User"},v()(this.user)),m("p",{className:"helpText"},g().translator.trans("flarum-gdpr.lib.request_data.text")),m("div",{className:"Form-group"},m(l(),{className:"Button Button--primary Button--block",onclick:function(){return t.requestExport()},loading:this.loading,disabled:this.loading},g().translator.trans("flarum-gdpr.lib.request_data.request_button")))))},e.requestExport=function(){this.loading=!0,g().request({method:"POST",url:g().forum.attribute("apiUrl")+"/gdpr/export",body:{data:{attributes:{userId:this.user.id()}}}}).then(this.hide.bind(this),this.loaded.bind(this))},r}(y());const x=flarum.core.compat["admin/components/AdminNav"];var N=t.n(x);const D=flarum.core.compat["common/components/LinkButton"];var G=t.n(D);const w=flarum.core.compat["common/extenders"];var T=t.n(w);const O=flarum.core.compat["common/models/User"];var A=t.n(O);const P=flarum.core.compat["common/Model"];var M=t.n(P),z=function(t){function r(){return t.apply(this,arguments)||this}c(r,t);var e=r.prototype;return e.status=function(){return M().attribute("status").call(this)},e.reason=function(){return M().attribute("reason").call(this)},e.createdAt=function(){return M().attribute("createdAt",M().transformDate).call(this)},e.userConfirmedAt=function(){return M().attribute("userConfirmedAt",M().transformDate).call(this)},e.processedAt=function(){return M().attribute("processedAt",M().transformDate).call(this)},e.processorComment=function(){return M().attribute("processorComment").call(this)},e.processedMode=function(){return M().attribute("processedMode").call(this)},e.user=function(){return M().hasOne("user").call(this)},e.processedBy=function(){return M().hasOne("processedBy").call(this)},r}(M()),S=function(t){function r(){return t.apply(this,arguments)||this}c(r,t);var e=r.prototype;return e.file=function(){return M().attribute("file").call(this)},e.createdAt=function(){return M().attribute("createdAt",M().transformDate)},e.destroysAt=function(){return M().attribute("destroysAt",M().transformDate)},e.user=function(){return M().hasOne("user")},e.actor=function(){return M().hasOne("actor")},r}(M());const q=[(new(T().Store)).add("user-erasure-requests",z).add("exports",S),new(T().Model)(A()).attribute("canModerateExports").attribute("anonymized").hasOne("erasureRequest")],E=flarum.core.compat["admin/components/AdminPage"];var B=t.n(E);const j=flarum.core.compat["common/components/LoadingIndicator"];var C=t.n(j);const I=flarum.core.compat["common/components/Tooltip"];var U=t.n(I);const k=flarum.core.compat["common/Component"];var R=t.n(k);const F=flarum.core.compat["common/helpers/icon"];var L=t.n(F),H=function(t){function r(){return t.apply(this,arguments)||this}return c(r,t),r.prototype.view=function(){var t=this.attrs.extension;return t?m(U(),{text:t.extra["flarum-extension"].title},m(G(),{href:a().route("extension",{id:t.id})},m("span",{className:"ExtensionIcon ExtensionIcon--gdpr",style:t.icon},!!t.icon&&L()(t.icon.name)))):null},r}(R()),J=function(t){function r(){for(var r,e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];return(r=t.call.apply(t,[this].concat(a))||this).gdprDataTypes=[],r}c(r,t);var e=r.prototype;return e.oninit=function(r){t.prototype.oninit.call(this,r),this.loadGdprDataTypes()},e.headerInfo=function(){return{className:"GdprPage--header",icon:"fas fa-user-shield",title:a().translator.trans("flarum-gdpr.admin.gdpr_page.heading"),description:a().translator.trans("flarum-gdpr.admin.gdpr_page.description")}},e.loadGdprDataTypes=function(){var t=this;this.loading=!0,a().store.find("gdpr/datatypes").then((function(r){t.gdprDataTypes=r,t.loading=!1,m.redraw()}))},e.content=function(){return this.loading?m(C(),null):m("div",{className:"GdprPage"},m("h3",null,a().translator.trans("flarum-gdpr.admin.gdpr_page.settings.heading")),m("p",{className:"helpText"},a().translator.trans("flarum-gdpr.admin.gdpr_page.settings.help_text")),m(G(),{className:"Button",href:a().route("extension",{id:"flarum-gdpr"})},a().translator.trans("flarum-gdpr.admin.gdpr_page.settings.extension_settings_button")),m("hr",null),m("h3",null,a().translator.trans("flarum-gdpr.admin.gdpr_page.data_types.title")),m("p",{className:"helpText"},a().translator.trans("flarum-gdpr.admin.gdpr_page.data_types.help_text")),m("div",{className:"GdprGrid"},m("div",{class:"GdprGrid-row"},m("div",{className:"GdprGrid-header"},a().translator.trans("flarum-gdpr.admin.gdpr_page.data_types.type")),m("div",{className:"GdprGrid-header"},a().translator.trans("flarum-gdpr.admin.gdpr_page.data_types.export_description")),m("div",{className:"GdprGrid-header"},a().translator.trans("flarum-gdpr.admin.gdpr_page.data_types.anonymize_description")),m("div",{className:"GdprGrid-header"},a().translator.trans("flarum-gdpr.admin.gdpr_page.data_types.delete_description")),m("div",{className:"GdprGrid-header"},a().translator.trans("flarum-gdpr.admin.gdpr_page.data_types.extension"))),this.gdprDataTypes.map((function(t){return m("[",null,m("div",{class:"GdprGrid-row"},m("div",null,m(U(),{text:t.id()},m("span",{className:"helpText"},t.type()))),m("div",{className:"helpText"},t.exportDescription()),m("div",{className:"helpText"},t.anonymizeDescription()),m("div",{className:"helpText"},t.deleteDescription()),m("div",null,m(H,{extension:t.extension()?a().data.extensions[t.extension()]:null}))))}))),m("hr",null),m("h3",null,a().translator.trans("flarum-gdpr.admin.gdpr_page.user_table_data.title")),m("p",{className:"helpText"},a().translator.trans("flarum-gdpr.admin.gdpr_page.user_table_data.help_text")),m("div",{className:"GdprUserColumnData"},"Not yet implemented"))},r}(B()),K=function(t){function r(){return t.apply(this,arguments)||this}c(r,t);var e=r.prototype;return e.type=function(){return M().attribute("type").call(this)},e.exportDescription=function(){return M().attribute("exportDescription").call(this)},e.anonymizeDescription=function(){return M().attribute("anonymizeDescription").call(this)},e.deleteDescription=function(){return M().attribute("deleteDescription").call(this)},e.extension=function(){return M().attribute("extension").call(this)},r}(M());const Q=[].concat(q,[(new(T().Routes)).add("gdpr","/gdpr",J),(new(T().Store)).add("gdpr-datatypes",K)]),V={"gdpr/models/ErasureRequest":z,"gdpr/models/Export":S,"gdpr/components/RequestDataExportModal":b},W=Object.assign(V,{"gdpr/components/ExtensionLink":H,"gdpr/components/GdprPage":J,"gdpr/models/DataType":K}),X=flarum.core;a().initializers.add("flarum-gdpr",(function(){a().extensionData.for("flarum-gdpr").registerSetting((function(){return m("div",{className:"Form-group"},m("h3",null,a().translator.trans("flarum-gdpr.admin.settings.gdpr_page.title")),m("p",{className:"helpText"},a().translator.trans("flarum-gdpr.admin.settings.gdpr_page.help_text")),m(G(),{href:a().route("gdpr"),icon:"fas fa-user-shield",className:"Button"},a().translator.trans("flarum-gdpr.admin.nav.gdpr_button")))})).registerSetting({setting:"flarum-gdpr.allow-anonymization",label:a().translator.trans("flarum-gdpr.admin.settings.allow_anonymization"),help:a().translator.trans("flarum-gdpr.admin.settings.allow_anonymization_help"),type:"boolean"}).registerSetting({setting:"flarum-gdpr.allow-deletion",label:a().translator.trans("flarum-gdpr.admin.settings.allow_deletion"),help:a().translator.trans("flarum-gdpr.admin.settings.allow_deletion_help"),type:"boolean"}).registerSetting({setting:"flarum-gdpr.default-erasure",label:a().translator.trans("flarum-gdpr.admin.settings.default_erasure"),help:a().translator.trans("flarum-gdpr.admin.settings.default_erasure_help"),type:"select",options:{anonymization:a().translator.trans("flarum-gdpr.admin.settings.default_erasure_options.anonymization"),deletion:a().translator.trans("flarum-gdpr.admin.settings.default_erasure_options.deletion")}}).registerSetting({setting:"flarum-gdpr.default-anonymous-username",type:"string",label:a().translator.trans("flarum-gdpr.admin.settings.default_anonymous_username"),help:a().translator.trans("flarum-gdpr.admin.settings.default_anonymous_username_help")}).registerPermission({icon:"fas fa-user-minus",label:a().translator.trans("flarum-gdpr.admin.permissions.process_erasure"),permission:"processErasure"},"moderate").registerPermission({icon:"fas fa-file-export",label:a().translator.trans("flarum-gdpr.admin.permissions.process_export_for_others"),permission:"moderateExport"},"moderate").registerPermission({icon:"fas fa-eye",label:a().translator.trans("flarum-gdpr.admin.permissions.see_anonymized_user_badges"),permission:"seeAnonymizedUserBadges",allowGuest:!0},"view"),(0,n.extend)(o().prototype,"userActionItems",(function(t,r){r.canModerateExports()&&t.add("export-data",m(l(),{className:"Button",icon:"fas fa-file-export",onclick:function(){return a().modal.show(b,{user:r})}},a().translator.trans("flarum-gdpr.admin.userlist.columns.gdpr_actions.export",{username:p()(r)})))})),(0,n.extend)(N().prototype,"items",(function(t){t.add("gdpr",m(G(),{href:a().route("gdpr"),icon:"fas fa-user-shield",title:a().translator.trans("flarum-gdpr.admin.gdpr.title")},a().translator.trans("flarum-gdpr.admin.nav.gdpr_button")),48)}))})),Object.assign(X.compat,W)})(),module.exports=r})();
//# sourceMappingURL=admin.js.map