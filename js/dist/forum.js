module.exports=function(t){var e={};function r(a){if(e[a])return e[a].exports;var o=e[a]={i:a,l:!1,exports:{}};return t[a].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,a){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(a,o,function(e){return t[e]}.bind(null,o));return a},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=21)}([function(t,e){t.exports=flarum.core.compat["common/Model"]},function(t,e){t.exports=flarum.core.compat["forum/app"]},,function(t,e){t.exports=flarum.core.compat["components/Button"]},function(t,e){t.exports=flarum.core.compat["utils/extractText"]},function(t,e){t.exports=flarum.core.compat["components/Modal"]},function(t,e){t.exports=flarum.core.compat["utils/Stream"]},function(t,e){t.exports=flarum.core.compat["helpers/username"]},function(t,e){t.exports=flarum.core.compat["common/extend"]},function(t,e){t.exports=flarum.core.compat["utils/ItemList"]},function(t,e){t.exports=flarum.core.compat["common/components/Button"]},function(t,e){t.exports=flarum.core.compat["forum/components/SettingsPage"]},function(t,e){t.exports=flarum.core.compat["forum/components/HeaderSecondary"]},function(t,e){t.exports=flarum.core.compat["common/components/Page"]},function(t,e){t.exports=flarum.core.compat["components/Page"]},function(t,e){t.exports=flarum.core.compat.Component},function(t,e){t.exports=flarum.core.compat["components/LoadingIndicator"]},function(t,e){t.exports=flarum.core.compat["helpers/avatar"]},function(t,e){t.exports=flarum.core.compat["helpers/icon"]},function(t,e){t.exports=flarum.core.compat["helpers/humanTime"]},function(t,e){t.exports=flarum.core.compat["components/NotificationsDropdown"]},function(t,e,r){"use strict";r.r(e);var a=r(1),o=r.n(a),s=r(8),n=r(0),u=r.n(n),i=r(10),c=r.n(i),p=r(12),l=r.n(p),d=r(13),f=r.n(d),h=r(11),b=r.n(h);function g(t,e){return(g=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function y(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,g(t,e)}var v=r(5),q=r.n(v),N=r(3),x=r.n(N),_=function(t){function e(){return t.apply(this,arguments)||this}y(e,t);var r=e.prototype;return r.className=function(){return"RequestDataModal Modal--small"},r.title=function(){return app.translator.trans("blomstra-gdpr.forum.request_data.title")},r.content=function(){return m("div",{className:"Modal-body"},m("div",{className:"Form Form--centered"},m("p",{className:"helpText"},app.translator.trans("blomstra-gdpr.forum.request_data.text")),m("div",{className:"Form-group"},x.a.component({className:"Button Button--primary Button--block",type:"submit",loading:this.loading},app.translator.trans("blomstra-gdpr.forum.request_data.request_button")))))},r.onsubmit=function(t){t.preventDefault(),this.loading=!0,app.request({method:"POST",url:app.forum.attribute("apiUrl")+"/gdpr/export"}).then(this.hide.bind(this),this.loaded.bind(this))},e}(q.a),w=r(4),R=r.n(w),B=r(9),M=r.n(B),C=r(6),F=r.n(C),O=function(t){function e(){return t.apply(this,arguments)||this}y(e,t);var r=e.prototype;return r.oninit=function(e){t.prototype.oninit.call(this,e),this.reason=F()(""),this.password=F()("")},r.className=function(){return"RequestErasureModal Modal--small"},r.title=function(){return app.translator.trans("blomstra-gdpr.forum.request_erasure.title")},r.content=function(){return m("div",{className:"Modal-body"},m("div",{className:"Form Form--centered"},this.fields().toArray()))},r.fields=function(){var t=this,e=new M.a,r=app.session.user.erasureRequest();return r?(e.add("status",m("div",{className:"Form-group"},m("p",{className:"helpText"},app.translator.trans("blomstra-gdpr.forum.request_erasure.status."+r.status())))),r.reason()&&e.add("reason",m("div",{className:"Form-group"},m("p",{className:"helpText"},app.translator.trans("blomstra-gdpr.forum.request_erasure.reason",{reason:r.reason()})))),e.add("cancel",m("div",{className:"Form-group"},x.a.component({className:"Button Button--primary Button--block",onclick:this.oncancel.bind(this),loading:this.loading},app.translator.trans("blomstra-gdpr.forum.request_erasure.cancel_button"))))):(e.add("text",m("p",{className:"helpText"},app.translator.trans("blomstra-gdpr.forum.request_erasure.text"))),e.add("password",m("div",{className:"Form-group"},m("input",{type:"password",className:"FormControl",bidi:this.password,placeholder:R()(app.translator.trans("blomstra-gdpr.forum.request_erasure.password_label"))}))),e.add("reason",m("div",{className:"Form-group"},m("textarea",{className:"FormControl",value:this.reason(),oninput:function(e){return t.reason(e.target.value)},placeholder:R()(app.translator.trans("blomstra-gdpr.forum.request_erasure.reason_label"))}))),e.add("submit",m("div",{className:"Form-group"},x.a.component({className:"Button Button--primary Button--block",type:"submit",loading:this.loading},app.translator.trans("blomstra-gdpr.forum.request_erasure.request_button"))))),e},r.oncancel=function(t){var e=this;this.loading=!0,m.redraw(),app.session.user.erasureRequest().delete().then((function(){e.loading=!1,m.redraw()}))},r.data=function(){return{reason:this.reason(),status:"user_confirmed",relationships:{user:app.session.user}}},r.onsubmit=function(t){var e=this;t.preventDefault(),this.loading=!0,app.store.createRecord("user-erasure-requests").save(this.data(),{meta:{password:this.password()}}).then((function(t){app.session.user.pushData({relationships:{erasureRequest:t}}),e.loading=!1,m.redraw()})).catch((function(){e.loading=!1,m.redraw()}))},e}(q.a),A=function(t){function e(){return t.apply(this,arguments)||this}return y(e,t),e}(u.a);Object.assign(A.prototype,{status:u.a.attribute("status"),reason:u.a.attribute("reason"),createdAt:u.a.attribute("createdAt",u.a.transformDate),userConfirmedAt:u.a.attribute("userConfirmedAt",u.a.transformDate),processedAt:u.a.attribute("processedAt",u.a.transformDate),processorComment:u.a.attribute("processorComment"),user:u.a.hasOne("user"),processedBy:u.a.hasOne("processedBy")});var j=r(14),k=r.n(j),L=r(15),P=r.n(L),S=r(16),D=r.n(S),T=r(17),E=r.n(T),z=r(18),I=r.n(z),U=r(7),G=r.n(U),H=r(19),J=r.n(H),K=function(t){function e(){return t.apply(this,arguments)||this}y(e,t);var r=e.prototype;return r.oninit=function(e){t.prototype.oninit.call(this,e),this.comments=F()(""),this.loading={}},r.className=function(){return"ProcessErasureRequestModal Modal--small"},r.title=function(){return app.translator.trans("blomstra-gdpr.forum.process_erasure.title")},r.content=function(){return m("div",{className:"Modal-body"},m("div",{className:"Form Form--centered"},this.fields().toArray()))},r.fields=function(){var t=this,e=new M.a;return e.add("text",m("p",{className:"helpText"},app.translator.trans("blomstra-gdpr.forum.process_erasure.text",{name:G()(this.attrs.request.user())}))),e.add("comments",m("div",{className:"Form-group"},m("textarea",{className:"FormControl",value:this.comments(),oninput:function(e){return t.comments(e.target.value)},placeholder:R()(app.translator.trans("blomstra-gdpr.forum.process_erasure.comments_label"))}))),app.forum.attribute("erasureAnonymizationAllowed")&&e.add("anonymize",m("div",{className:"Form-group"},x.a.component({className:"Button Button--primary Button--block",type:"submit",loading:this.loading.anonymization,onclick:function(e){return t.onsubmit(e,"anonymization")}},app.translator.trans("blomstra-gdpr.forum.process_erasure.anonymization_button")))),app.forum.attribute("erasureDeletionAllowed")&&e.add("delete",m("div",{className:"Form-group"},x.a.component({className:"Button Button--danger Button--block",type:"submit",loading:this.loading.deletion,onclick:function(e){return t.onsubmit(e,"deletion")}},app.translator.trans("blomstra-gdpr.forum.process_erasure.deletion_button")))),e},r.onsubmit=function(t,e){var r=this;t.preventDefault(),confirm(app.translator.trans("blomstra-gdpr.forum.process_erasure.confirm",{name:R()(G()(this.attrs.request.user())),mode:R()(e)}))&&(this.loading[MediaSource]=!0,m.redraw(),this.attrs.request.save({processor_comment:this.comments()},{meta:{mode:e}}).then((function(t){app.store.remove(t),r.loading[MediaSource]=!1,m.redraw(),r.hide()})).catch((function(){r.loading[MediaSource]=!1,m.redraw()})))},e}(q.a),Q=function(t){function e(){return t.apply(this,arguments)||this}y(e,t);var r=e.prototype;return r.view=function(){var t=this,e=app.store.all("user-erasure-requests"),r=this.attrs.state;return m("div",{className:"NotificationList ErasureRequestsList"},m("div",{className:"NotificationList-header"},m("h4",{className:"App-titleControl App-titleControl--text"},app.translator.trans("blomstra-gdpr.forum.erasure_requests.title"))),m("div",{className:"NotificationList-content"},m("ul",{className:"NotificationGroup-content"},e.length?e.map((function(e){return m("li",null,m("a",{onclick:t.showModal.bind(t,e),className:"Notification Request"},E()(e.user()),I()("fas fa-user-edit",{className:"Notification-icon"}),m("span",{className:"Notification-content"},app.translator.trans("blomstra-gdpr.forum.erasure_requests.item_text",{name:G()(e.user())})),J()(e.createdAt())))})):r.loading?D.a.component({className:"LoadingIndicator--block"}):m("div",{className:"NotificationList-empty"},app.translator.trans("blomstra-gdpr.forum.erasure_requests.empty_text")))))},r.showModal=function(t){app.modal.show(K,{request:t})},e}(P.a),V=function(t){function e(){return t.apply(this,arguments)||this}y(e,t);var r=e.prototype;return r.oninit=function(e){t.prototype.oninit.call(this,e),app.history.push("erasure-requests"),app.erasureRequests.load(),this.bodyClass="App--ErasureRequests"},r.view=function(){return m("div",{className:"ErasureRequestsPage"},m(Q,{state:app.erasureRequests}))},e}(k.a),W=r(20),X=function(t){function e(){return t.apply(this,arguments)||this}y(e,t),e.initAttrs=function(e){e.label=e.label||app.translator.trans("blomstra-gdpr.forum.erasure_requests.tooltip"),e.icon=e.icon||"fas fa-user-minus",t.initAttrs.call(this,e)};var r=e.prototype;return r.getMenu=function(){return m("div",{className:"Dropdown-menu "+this.attrs.menuClassName,onclick:this.menuClick.bind(this)},this.showing?Q.component({state:this.attrs.state}):"")},r.goToRoute=function(){m.route.set(app.route("erasure-requests"))},r.getUnreadCount=function(){return this.attrs.state.requestsLoaded?app.store.all("erasure-requests").length:app.forum.attribute("erasureRequestCount")},r.getNewCount=function(){return this.getUnreadCount()},e}(r.n(W).a),Y=function(){function t(t){this.app=t,this.loading=!1,this.requestsLoaded=!1}return t.prototype.load=function(){var t=this;this.requestsLoaded||(this.loading=!0,m.redraw(),app.store.find("user-erasure-requests").then((function(){return t.requestsLoaded=!0}),(function(){})).then((function(){t.loading=!1,m.redraw()})))},t}();o.a.initializers.add("blomstra-gdpr",(function(){o.a.store.models["user-erasure-requests"]=A,o.a.store.models.users.prototype.erasureRequest=u.a.hasOne("erasureRequest"),o.a.routes["erasure-requests"]={path:"/erasure-requests",component:V},o.a.erasureRequests=new Y(o.a),Object(s.extend)(f.a.prototype,"oninit",(function(){m.route.param("erasureRequestConfirmed")&&o.a.alerts.show({type:"success"},o.a.translator.trans("blomstra-gdpr.forum.erasure_request_confirmed"))})),Object(s.extend)(b.a.prototype,"accountItems",(function(t){t.add("gdprErasure",c.a.component({className:"Button",onclick:function(){return o.a.modal.show(O)}},o.a.translator.trans("blomstra-gdpr.forum.settings.request_erasure_button")))})),Object(s.extend)(b.a.prototype,"accountItems",(function(t){t.add("gdprExport",c.a.component({className:"Button",onclick:function(){return o.a.modal.show(_)}},o.a.translator.trans("blomstra-gdpr.forum.settings.export_data_button")))})),Object(s.extend)(l.a.prototype,"items",(function(t){o.a.forum.attribute("erasureRequestCount")&&t.add("UsernameRequests",m(X,{state:o.a.erasureRequests}),20)}))}))}]);
//# sourceMappingURL=forum.js.map